<?xml version="1.0"?>
<odoo>
<data>
    <!-- TODO: put here a reminder on what to do at the first edition -->
    <record id="lcc_members_form_view" model="ir.ui.view">
        <field name="name">LCC Members Form View</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="sequence">99999</field>
        <field name="arch" type="xml">
            <!-- ################### -->
            <!-- ADDITION OF BUTTONS -->
            <!-- ################### -->
            <button name="toggle_active" position="before">
                <button name="act_show_contract" type="object" class="oe_stat_button" icon="fa-book" context="{'default_contract_type': 'sale', 'contract_type': 'sale'}" attrs="{'invisible': [('customer','=',False)]}" help="Show the sale contracts for this partner">
                    <field name="sale_contract_count" widget="statinfo" string="Sale contacts"/>
                </button>
                <!-- button name="act_show_contract" type="object" class="oe_stat_button" icon="fa-book" context="{'default_contract_type': 'purchase', 'contract_type': 'purchase'}" attrs="{'invisible': [('supplier','=',False)]}" help="Montrer les convenitions de ce professionel">
                    <field name="purchase_contract_count" widget="statinfo" string="Purchases contracts"/>
                </button-->
            </button>

            <!-- ################### -->
            <!-- MAIN DISPLAY UPDATE -->
            <!-- ################### -->
            <xpath expr="//field[@name='name']" position="replace">
                    <field name="name" default_focus="1" placeholder="Commercial Name" attrs="{'readonly': [('is_company', '=', False)],'required': [('is_company', '=', True)]}" widget="field_partner_autocomplete" />
            </xpath>
            <xpath expr="//field[@name='parent_id']" position="replace">
                <field name="parent_id"
                            widget="res_partner_many2one"
                            placeholder="Company"
                            domain="[('is_company', '=', True)]"
                            context="{'default_is_company': True, 'show_vat': True}"
                            attrs="{'invisible': ['|',('is_company','=', True),('contact_type','=','standalone')]}"/>
            </xpath>
            <xpath expr="//field[@name='vat']" position="replace">
                <field name="membership_state" string="Subscription status"/>
                <field name="member_type_id" string="Subscription type" attrs="{'invisible': [('is_company', '=', False)]}"/>
                <field name="currency_exchange_office" attrs="{'invisible': [('is_company', '=', False)]}"/>
                <field name="is_volunteer" attrs="{'invisible': [('is_company','=', True)]}"/>
                <field name="team_id" string="Local group" options="{'limit': 16, 'create': false, 'create_edit': false}"/>
                <field name="user_id" string="Referent" />
                <field name="ref" string="Subcription number"/>
                <field name="vat" placeholder="e.g. BE0477472701" attrs="{'invisible': [('is_company', '=', False)]}" widget="field_partner_autocomplete"/>

            </xpath>
            <xpath expr="//field[@name='phone']" position="replace">
                <label for="phone"/>
                <div class="o_row">
                    <field name="phone" widget="phone"/>
                    <button type="action" name="137" class="btn-sm btn-link mb4 fa fa-envelope-o" aria-label="Send SMS" title="Send SMS" attrs="{'invisible':[('phone', '=', False)]}" context="{'field_name': 'phone'}"/>
                </div>
                <label for="phone_pro"/>
                <div class="o_row">
                    <field name="phone_pro" widget="phone"/>
                    <button type="action" name="137" class="btn-sm btn-link mb4 fa fa-envelope-o" aria-label="Send SMS" title="Send SMS" attrs="{'invisible':[('phone_pro', '=', False)]}" context="{'field_name': 'phone_pro'}"/>
                </div>
            </xpath>
            <xpath expr="//field[@name='mobile']" position="replace">
                <label for="mobile"/>
                <div class="o_row">
                    <field name="mobile" widget="phone"/>
                    <button type="action" name="137" class="btn-sm btn-link mb4 fa fa-envelope-o" aria-label="Send SMS" title="Send SMS" attrs="{'invisible':[('mobile', '=', False)]}" context="{'field_name': 'mobile'}"/>
                </div>
            </xpath>
            <xpath expr="//field[@name='email']" position="replace">
                <field name="is_blacklisted" invisible="1"/>
                <label for="email" class="oe_inline"/>
                <div class="o_row o_row_readonly">
                    <i class="fa fa-ban" style="color: red;" role="img" title="This email is blacklisted for mass mailing" aria-label="Blacklisted" attrs="{'invisible': [('is_blacklisted', '=', False)]}" groups="base.group_user"/>
                    <field name="email" widget="email"/>
                </div>
            </xpath> 

            <!-- ################ -->
            <!-- NOTEBOOK UPDATES -->
            <!-- ################ -->

            <!-- page Membership -->       
            <xpath expr="//field[@name='free_member']" position="after">
                <field name="to_renew" />
            </xpath>
            <xpath expr="//field[@name='associate_member']/.." position="after">
                <group name="convention" string="Convention" attrs="{'invisible': [('is_company', '=', False)]}">
                    <field name="convention_signature_date" attrs="{'invisible': [('is_company', '=', False)]}"/>
                    <field name="convention_specific_agreement" attrs="{'invisible': [('is_company', '=', False)]}"/>
                </group>
                <field name="member_comment" placeholder="Subscription private note"/>
                <separator string="Subscription history" attrs="{'invisible': [('is_company', '=', False)]}"/>
            </xpath>    

            <!-- page Internal Note --> 
            <xpath expr="//page[@name='internal_notes']/field[@name='comment']" position="after">
                <field name="private_comment" placeholder="Private Note"/>
            </xpath>

            <!-- page Other Positions -->
            <xpath expr="//page[@name='other_position']/field[@name='other_contact_ids']/kanban" position="attributes">
                <attribute name="create">true</attribute>
            </xpath>

            <!-- ################## -->
            <!-- NOTEBOOK NEW PAGES -->
            <!-- ################## -->
            <xpath expr="//notebook/page[1]" position="before">
                <!-- page Membership -->
                <page name="annuaire" string="Directory" attrs="{'invisible': [('is_company','=',False)]}" autofocus="autofocus">
                    <group name="classification" string="Classification (to find easily pro. in the directory)">
                        <field name="legal_activity_code" attrs="{'invisible': [('is_company', '=', False)]}"/>
                        <field name="industry_id" string="Main activity" attrs="{'invisible': [('is_company', '=', False)]}"/>
                        <field name="secondary_industry_ids" widget="many2many_tags" string="Others activities" attrs="{'invisible': [('is_company', '=', False)]}"/>
                        <field name="detailed_activity" placeholder="Detailled activy (Ex.  lavender honey)" attrs="{'invisible': [('is_company', '=', False)]}"/>
                        <field name="keywords" placeholder="keywords giving more information on activities. splite keyword using ;" attrs="{'invisible': [('is_company', '=', False)]}"/>
                        <field name="itinerant" attrs="{'invisible': [('is_company', '=', False)]}"/>
                    </group>
                    <group name="presentation" string="website presentation">
                        <field name="opening_time" placeholder="Opening hours(ex. every day from 9am to 18pm or opening hours day by day)" attrs="{'invisible': [('is_company', '=', False)]}"/>
                        <field name="reasons_choosing_mlc" string="Subscription reason" placeholder="Why the pro. subscribe to LCC? allow to involve customers"/>
                        <field name="discount"/>
                    </group>
                    <!-- <group colspan="2" col="2">
                        <separator string="Geolocation" colspan="2"/>
                        <button string="Geolocate" name="geo_localize" colspan="2" icon="fa-check" type="object"/>
                        <div>
                            <span class="oe_inline">( On</span>
                            <field name="date_localization" nolabel="1" class="oe_inline"/>
                            <span>: Lat :</span>
                            <field name="partner_latitude" nolabel="1" class="oe_inline"/>
                            <span>;  Long:</span>
                            <field name="partner_longitude" nolabel="1" class="oe_inline"/>
                            <span>)</span>
                        </div>
                    </group> -->
                    <group name="extra_images" string="Extra Images">
                        <div class="alert alert-warning">
                            <span><b>Attention:</b> Odoo ne compresse pas les images. la somme totale de vos images ne doit pas d√©passer 4mo. Pour compresser vos images vous pouvez par exemple utiliser ce site : <a href="https://compressjpeg.com/fr/" target="_blank">https://compressjpeg.com/fr/</a></span>
                        </div>
                        <field name="partner_image_ids" class="o_website_sale_image_list" attrs="{'invisible': [('is_company', '=', False)]}" context="{'default_name': name, 'default_partner_id': active_id}" nolabel="1">
                            <kanban string="Partner Images" class="o_attachments_previews">
                                <field name="id"/>
                                <field name="name"/>
                                <field name="image"/>
                                <templates>
                                    <t t-name="kanban-box">
                                        <div class="o_attachment oe_kanban_global_click o_website_sale_image_card">
                                            <div class="o_attachment_wrap">
                                                <div class="o_image_box">
                                                    <div class="o_attachment_image" t-attf-style="background-image:url({{kanban_image('partner.image', 'image', record.id.raw_value)}});"/>
                                                    <div t-attf-class="o_image_overlay" t-att-title="record.name.value"/>
                                                    <div class="o_website_sale_image_card_title" t-att-title="record.name.value">
                                                        <field name="name"/>
                                                    </div>
                                                </div>

                                                <t t-set="size" t-value="[record.image.value][0]"/>
                                                <t t-set="size_status" t-value="'normal'" t-if="size.indexOf('Bytes') !== -1 or ( size.indexOf('Kb') !== -1 and size[2]=='.')"/>
                                                <t t-set="size_status" t-value="'warning'" t-elif="( size.indexOf('Kb') !== -1 and size[3]=='.')"/>
                                                <t t-set="size_status" t-value="'danger'"  t-else=""/>
                                                <t t-set="message" t-value="'Acceptable file size'" t-if="size_status == 'normal'"></t>
                                                <t t-set="message" t-value="'Huge file size. The image should be optimized/reduced.'" t-elif="size_status == 'warning'"></t>
                                                <t t-set="message" t-value="'Optimization required! Reduce the image size or increase your compression settings.'" t-else=""></t>

                                                <span t-attf-class="o_website_sale_image_card_size badge badge-#{size_status}" t-att-title="message">
                                                    <t t-esc="record.image.value"/>
                                                </span>
                                            </div>
                                        </div>
                                    </t>
                                </templates>
                            </kanban>
                        </field>
                    </group>
                </page>
                <!-- page Social Networks -->
                <page string="Social networks" name="social">
                    <group>
                        <field name="extra_contact_ids" widget="contactInfoWidget" nolabel="0" colspan="1"/>
                    </group>                        
                </page>
            </xpath>
        </field>
    </record>




    <record id="members_search_view" model="ir.ui.view">
        <field name="name">Members search View</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <search string="Membership Partners">
                <field name="name" filter_domain="['|','|',('display_name','ilike',self),('ref','=',self),('email','ilike',self)]"/>
                <field name="ref" string="Member ID"/>
                <field name="team_id" string="Local group"/>
                <field name="street" string="Legal name or street"/>
                <field name="parent_id" domain="[('is_company','=',True)]" operator="child_of"/>
                <field name="membership_state" string="member status"/>

                <filter name="filter_my_partners" help="My Contacts" domain="[('user_id','=',uid)]"/>
                <filter string="My Favorites" name="my_partners" domain="[('favorite_user_ids', 'in', uid)]"/>
                <separator/>
                <filter string="My local group" name="Local group" domain="[('team_id.member_ids', 'in', uid)]"/>
                <separator/>
                <filter string="Person" name="type_person" domain="[('is_company','=',False)]"/>
                <filter string="Professionals" name="type_company" domain="[('is_company','=',True)]"/>
                <separator/>
                <filter string="Customers" name="customer" domain="[('customer','=',True), ('parent_id', '=', False)]"/>
                <filter string="Vendors" name="supplier" domain="[('supplier','=',True), ('parent_id', '=', False)]"/>
                <filter string="Archived" name="inactive" domain="[('active','=',False)]"/>
                <separator/>
                <field name="category_id" string="Tag" filter_domain="[('category_id','ilike', self)]"/>
                <field name="user_id"/>
                <field name="phone" filter_domain="['|',('phone','ilike',self),('mobile','=',self)]"/>
                <filter name="all_non_members" domain="[('membership_state', 'in', ['none','canceled','old','waiting'])]" string="All non Members" help="None/Canceled/Old/Waiting"/>
                <filter name="all_members" domain="[('membership_state', 'in', ['invoiced','paid','free'])]" string="All Members" help="Invoiced/Paid/Free"/>   
                <filter name="filter_running_contract" string="With agreement" domain="['|', ('contract_ids.date_end', '&gt;=', context_today().strftime('%Y-%m-%d')), ('contract_ids.date_end', '=', False)]"/>
                <group expand="0" name="group_by" string="Group By">
                    <filter name="salesperson" string="Salesperson" domain="[]" context="{'group_by' : 'user_id'}"/>
                    <filter string="Associate Member" name="associate" domain="[]" context="{'group_by':'associate_member'}"/>
                    <filter string=" Membership State" name="membership_state" domain="[]" context="{'group_by':'membership_state'}"/>
                    <filter string="Start Date" name="start_month" help="Starting Date Of Membership" domain="[]" context="{'group_by':'membership_start'}"/>
                    <filter string="End Date" name="end_month" help="Ending Date Of Membership" domain="[]" context="{'group_by':'membership_stop'}"/>
                </group>
            </search>
        </field>
    </record>


    <record id="members_list_view" model="ir.ui.view">
        <field name="name">Members List View</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="membership.membership_members_tree"/>
        <field name="arch" type="xml">
            <field name="name" position="before">
                <field name="ref"/>
                <field name="function" invisible="1"/>
                <field name="phone"/>
                <field name="email"/>
            </field>
        </field>
    </record>


    <record id="partner_list_view" model="ir.ui.view">
        <field name="name">Partner List View</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <field name="category_id" position="attributes">
                <attribute name="widget">many2many_tags</attribute>
            </field>
        </field>
    </record>

    <record id="members_kanban_view" model="ir.ui.view">
        <field name="name">Members kanban View</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//field[@name='type']" position="after">
                    <field name="ref"/>
                    <field name="membership_state"/>
                    <field name="team_id"/>
                </xpath>
                <xpath expr="//div[hasclass('oe_kanban_details')]" position="inside">
                    <div class="o_kanban_record_bottom">
                        <div class="oe_kanban_bottom_left">
                            <div class="oe_kanban_bottom_right">
                                <b>
                                    <span>Local group:</span>
                                    <field name="team_id" groups="base.group_user"/>
                                </b>
                            </div>
                        </div>
                    </div>
                </xpath>
                <xpath expr="//div[hasclass('oe_kanban_partner_categories')]" position="before">
                    <br/>
                    <span style="color:#566d24;">
                        <b>
                            <field name="membership_state"/>
                        </b>
                        -
                        <field name="ref"/>
                    </span>
                </xpath>

            </data>
        </field>
    </record>

    <record model="ir.ui.view" id="view_partner_image_form">
        <field name="name">partner.image.form</field>
        <field name="model">partner.image</field>
        <field name="arch" type="xml">
            <form string="Partner Images">
                <div class="row o_website_sale_image_modal">
                    <div class="col-md-6 col-xl-5">
                        <div class="oe_title">
                            <label class="small text-muted" for="name" string="Image Name"/>
                            <h2><field name="name" placeholder="Image Name" required="True"/></h2>
                            <field name="partner_id" invisible="1"/>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-7 text-center o_website_sale_image_modal_container">
                        <field name="image" widget="image"/>
                    </div>
                </div>
            </form>
        </field>
    </record>
</data>
</odoo>
